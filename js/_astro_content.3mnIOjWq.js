import{escape}from"html-escaper";import{Traverse}from"neotraverse/modern";import pLimit from"p-limit";import{z}from"zod";import{removeBase,isRemotePath,prependForwardSlash}from"@astrojs/internal-helpers/path";import{A as AstroError,U as UnknownContentCollectionError,a as createComponent,R as RenderUndefinedEntryError,u as unescapeHTML,d as renderTemplate,h as renderUniqueStylesheet,i as renderScriptElement,j as createHeadAndContent,r as renderComponent}from"./astro/server.CL5zRllf.js";import"kleur/colors";import*as devalue from"devalue";const CONTENT_IMAGE_FLAG="astroContentImageFlag",IMAGE_IMPORT_PREFIX="__ASTRO_IMAGE_",VALID_INPUT_FORMATS=["jpeg","jpg","png","tiff","webp","gif","svg","avif"],VALID_SUPPORTED_FORMATS=["jpeg","jpg","png","tiff","webp","gif","svg","avif"],DEFAULT_OUTPUT_FORMAT="webp",DEFAULT_HASH_PROPS=["src","width","height","format","quality","fit","position"];function imageSrcToImportId(e,t){if(e=removeBase(e,"__ASTRO_IMAGE_"),isRemotePath(e))return;const n=e.split(".").at(-1)?.toLowerCase();if(!n||!VALID_INPUT_FORMATS.includes(n))return;const o=new URLSearchParams(CONTENT_IMAGE_FLAG);return t&&o.set("importer",t),`${e}?${o.toString()}`}class ImmutableDataStore{_collections=new Map;constructor(){this._collections=new Map}get(e,t){return this._collections.get(e)?.get(String(t))}entries(e){return[...(this._collections.get(e)??new Map).entries()]}values(e){return[...(this._collections.get(e)??new Map).values()]}keys(e){return[...(this._collections.get(e)??new Map).keys()]}has(e,t){const n=this._collections.get(e);return!!n&&n.has(String(t))}hasCollection(e){return this._collections.has(e)}collections(){return this._collections}static async fromModule(){try{const e=await import("./_astro_data-layer-content.4rR1w_dV.js");if(e.default instanceof Map)return ImmutableDataStore.fromMap(e.default);const t=devalue.unflatten(e.default);return ImmutableDataStore.fromMap(t)}catch{}return new ImmutableDataStore}static async fromMap(e){const t=new ImmutableDataStore;return t._collections=e,t}}function dataStoreSingleton(){let e;return{get:async()=>(e||(e=ImmutableDataStore.fromModule()),e),set:t=>{e=t}}}const globalDataStore=dataStoreSingleton(),__vite_import_meta_env__={ASSETS_PREFIX:void 0,BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SITE:"https://findforce.io",SSR:!0};function createCollectionToGlobResultMap({globResult:e,contentDir:t}){const n={};for(const o in e){const r=o.replace(new RegExp(`^${t}`),"").split("/");if(r.length<=1)continue;const a=r[0];n[a]??={},n[a][o]=e[o]}return n}function createGetCollection({contentCollectionToEntryMap:e,dataCollectionToEntryMap:t,getRenderEntryImport:n,cacheEntriesByCollection:o,liveCollections:r}){return async function(a,i){if(a in r)throw new AstroError({...UnknownContentCollectionError,message:`Collection "${a}" is a live collection. Use getLiveCollection() instead of getCollection().`});const c="function"==typeof i,l=await globalDataStore.get();let s;if(a in e)s="content";else{if(!(a in t)){if(l.hasCollection(a)){const{default:e}=await import("./content-assets.CPbsr5sg.js"),t=[];for(const n of l.values(a)){const o=updateImageReferencesInData(n.data,n.filePath,e);let r={...n,data:o,collection:a};r.legacyId&&(r=emulateLegacyEntry(r)),c&&!i(r)||t.push(r)}return t}return console.warn(`The collection ${JSON.stringify(a)} does not exist or is empty. Please check your content config file for errors.`),[]}s="data"}const d=Object.values("content"===s?e[a]:t[a]);let p=[];if(!Object.assign(__vite_import_meta_env__,{_:process.env._})?.DEV&&o.has(a))p=o.get(a);else{const e=pLimit(10);p=await Promise.all(d.map((t=>e((async()=>{const e=await t();return"content"===s?{id:e.id,slug:e.slug,body:e.body,collection:e.collection,data:e.data,render:async()=>render({collection:e.collection,id:e.id,renderEntryImport:await n(a,e.slug)})}:{id:e.id,collection:e.collection,data:e.data}}))))),o.set(a,p)}return c?p.filter(i):p.slice()}}function emulateLegacyEntry({legacyId:e,...t}){const n={...t,id:e,slug:t.id};return{...n,render:()=>renderEntry(n)}}z.object({tags:z.array(z.string()).optional(),maxAge:z.number().optional(),lastModified:z.date().optional()});const CONTENT_LAYER_IMAGE_REGEX=/__ASTRO_IMAGE_="([^"]+)"/g;async function updateImageReferencesInBody(e,t){const{default:n}=await import("./content-assets.CPbsr5sg.js"),o=new Map,{getImage:r}=await import("./_astro_assets.B0misIUn.js").then((e=>e._));for(const[a,i]of e.matchAll(CONTENT_LAYER_IMAGE_REGEX))try{const e=JSON.parse(i.replaceAll("&#x22;",'"'));let a;if(URL.canParse(e.src))a=await r(e);else{const i=imageSrcToImportId(e.src,t),c=n.get(i);if(!i||o.has(i)||!c)continue;a=await r({...e,src:c})}o.set(i,a)}catch{throw new Error(`Failed to parse image reference: ${i}`)}return e.replaceAll(CONTENT_LAYER_IMAGE_REGEX,((e,t)=>{const n=o.get(t);if(!n)return e;const{index:r,...a}=n.attributes;return Object.entries({...a,src:n.src,srcset:n.srcSet.attribute,...Object.assign(__vite_import_meta_env__,{_:process.env._}).DEV?{"data-image-component":"true"}:{}}).map((([e,t])=>t?`${e}="${escape(t)}"`:"")).join(" ")}))}function updateImageReferencesInData(e,t,n){return new Traverse(e).map((function(e,o){if("string"==typeof o&&o.startsWith("__ASTRO_IMAGE_")){const r=o.replace("__ASTRO_IMAGE_",""),a=imageSrcToImportId(r,t);if(!a)return void e.update(r);const i=n?.get(a);i?e.update(i):e.update(r)}}))}async function renderEntry(e){if(!e)throw new AstroError(RenderUndefinedEntryError);if("render"in e&&!("legacyId"in e))return e.render();if(e.deferredRender)try{const{default:t}=await import("./content-modules.COHZlQVn.js"),n=t.get(e.filePath);return render({collection:"",id:e.id,renderEntryImport:n})}catch(e){console.error(e)}const t=e?.rendered?.metadata?.imagePaths?.length&&e.filePath?await updateImageReferencesInBody(e.rendered.html,e.filePath):e?.rendered?.html;return{Content:createComponent((()=>renderTemplate`${unescapeHTML(t)}`)),headings:e?.rendered?.metadata?.headings??[],remarkPluginFrontmatter:e?.rendered?.metadata?.frontmatter??{}}}async function render({collection:e,id:t,renderEntryImport:n}){const o=new AstroError({...UnknownContentCollectionError,message:`Unexpected error while rendering ${String(e)} â†’ ${String(t)}.`});if("function"!=typeof n)throw o;const r=await n();if(null==r||"object"!=typeof r)throw o;const{default:a}=r;if(isPropagatedAssetsModule(a)){const{collectedStyles:e,collectedLinks:n,collectedScripts:r,getMod:i}=a;if("function"!=typeof i)throw o;const c=await i();if(null==c||"object"!=typeof c)throw o;return{Content:createComponent({factory(o,a,i){let l="",s="",d="";Array.isArray(e)&&(l=e.map((e=>renderUniqueStylesheet(o,{type:"inline",content:e}))).join("")),Array.isArray(n)&&(s=n.map((e=>renderUniqueStylesheet(o,{type:"external",src:prependForwardSlash(e)}))).join("")),Array.isArray(r)&&(d=r.map((e=>renderScriptElement(e))).join(""));let p=a;return t.endsWith("mdx")&&(p={components:c.components??{},...a}),createHeadAndContent(unescapeHTML(l+s+d),renderTemplate`${renderComponent(o,"Content",c.Content,p,i)}`)},propagation:"self"}),headings:c.getHeadings?.()??[],remarkPluginFrontmatter:c.frontmatter??{}}}if(r.Content&&"function"==typeof r.Content)return{Content:r.Content,headings:r.getHeadings?.()??[],remarkPluginFrontmatter:r.frontmatter??{}};throw o}function isPropagatedAssetsModule(e){return"object"==typeof e&&null!=e&&"__astroPropagation"in e}const liveCollections={},contentDir="/src/content/",contentEntryGlob="",contentCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),dataEntryGlob="",dataCollectionToEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir});createCollectionToGlobResultMap({globResult:{..."",...""},contentDir:contentDir});let lookupMap={};function createGlobLookup(e){return async(t,n)=>{const o=lookupMap[t]?.entries[n];if(o)return e[t][o]}}lookupMap={},new Set(Object.keys(lookupMap));const renderEntryGlob="",collectionToRenderEntryMap=createCollectionToGlobResultMap({globResult:"",contentDir:contentDir}),cacheEntriesByCollection=new Map,getCollection=createGetCollection({contentCollectionToEntryMap:contentCollectionToEntryMap,dataCollectionToEntryMap:dataCollectionToEntryMap,getRenderEntryImport:createGlobLookup(collectionToRenderEntryMap),cacheEntriesByCollection:cacheEntriesByCollection,liveCollections:liveCollections});export{DEFAULT_OUTPUT_FORMAT as D,VALID_SUPPORTED_FORMATS as V,DEFAULT_HASH_PROPS as a,getCollection as g};